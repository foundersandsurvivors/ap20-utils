ap20-utils/basex-admin/bin
==========================

Utility shell scripts for creating/replacing xml databases from xml files.

WARNING: Location of source XML files and key directories is defined by environment variables. See etc/environment. Modify as required and add the variables defined there as persistent environment variables on your system.

Usage
-----

./dbload-from-xml.sh dbname
---------------------------

Creates (or replaces) a BaseX database named "dbname" from XML files located in "/data/bx/xml/dbname".

It will generate a BaseX script named /srv/basex/scripts/replacedb-normpm.bxs containing:
<pre>
Example:  ./dbload-from-xml.sh normpm [rsync]

-- script: /srv/basex/scripts/replacedb-normpm.bxs
drop db normpm
set attrindex off
set textindex off
set ftindex off
CREATE DB normpm
CREATE DB normpm /data/bx/xml/normpm
CREATE INDEX ATTRIBUTE
CREATE INDEX TEXT
OPTIMIZE ALL
open normpm
flush
info DB
info index tag
close
list normpm
</pre>

The script is then executed by `./dbload-from-xml.sh` like so:
<pre>
-- running bin/basexclient -c /srv/basex/scripts/replacedb-normpm.bxs
</pre>

Note if the dbname contains the string "FT", then a free text index will be created instead of a normal BaseX text index. See http://docs.basex.org/wiki/Indexes for more information on BaseX indexes.

The optional `rsync` option will pull the xml from the server named as "xmlfiles-server" in your .ssh/config. 

./do-all-basex-databases.sh info|reindex|export|backup|cleanup
--------------------------------------------------------------

Creates a script for the specified function for EACH database. You then MANUALLY run this script using the instructions generated by the script.

The script uses BaseX's REST interface to get the database list.

You'll need to modify your scripts for the hostname, or allow the script to default appropropraitely.

./updated_databases.pl
----------------------

Looks for a semaphore file in /data/bx/xml named:
<pre>
    .updated_DBNAME
</pre>

If found this script will run ./dbload-from-xml.sh dbname.

You can cron this script. From a remote host, push xml directories/files over and have cron automatically recreate databases as needed.

./restoredb.sh
--------------

Restores a basex database from latest backup.

Usage:
<pre>
./restoredb.sh dbname
</pre>

